"use strict";function vote(e){$http(Constants.API.URL+"bathroom/vote/"+e+"/"+ViewModel.model.map.selectedBathroom.id).post({gid:ViewModel.model.user.guser.id,ukey:ViewModel.model.user.guser.token}).then(function(e){iqwerty.toast.Toast("Thank you for your contribution!");var o=JSON.parse(e);delete o.total_score,Object.keys(o).forEach(function(e){ViewModel.model.map.selectedBathroom[e]=o[e]})}).catch(function(){return iqwerty.toast.Toast("You must be logged in to vote")})}function showLoading(){document.querySelector("."+Constants.Iden.LOADING).classList.remove(Constants.Iden.HIDDEN)}function hideLoading(){document.querySelector("."+Constants.Iden.LOADING).classList.add(Constants.Iden.HIDDEN)}function initMap(e){var o=arguments.length<=1||void 0===arguments[1]?DEFAULT_SMALL_MAP_OPTIONS:arguments[1];"undefined"==typeof google&&setTimeout(function(){return initMap(e,o)},100),_map=new google.maps.Map(document.getElementById(MAP_VIEW_SMALL),o),_map.setCenter({lat:e.lat,lng:e.lng});var t=ViewModel.model.map.location,a=t.lat,n=t.lng,l=t.accuracy;MainMap.addMyLocationMarker(_map,{lat:a,lng:n},l)}function attachBathroom(e){var o=new google.maps.Marker({position:{lat:e.lat,lng:e.lng},icon:Constants.ToiletImage.BATHROOM_MARKER});o.setMap(_map)}function bindBathroomData(e){hideLoading(),ViewModel.model.view.panel.display.detail="true",ViewModel.model.view.panel.display.add="",Object.assign(ViewModel.model.map.selectedBathroom,e)}var Constants=require("../../../../assets/js/constants"),MainMap=require("./mainmap"),ViewModel=require("./viewmodel"),shell=module.exports,MAP_VIEW_SMALL="map-view-small",DEFAULT_SMALL_MAP_OPTIONS={zoom:18,zoomControl:!0,disableDefaultUI:!0,draggable:!1,scrollwheel:!1,disableDoubleClickZoom:!0,streetViewControl:!0},_map=void 0;shell.openPanel=function(e){showLoading(),MainMap.openPanel(),$http(Constants.API.URL+"bathroom/get/id/"+e).cache().get().then(function(e){e=JSON.parse(e)[0],bindBathroomData(e),initMap({lat:e.lat,lng:e.lng}),attachBathroom(e)})},shell.closePanel=function(){MainMap.closePanel(),_map=null},shell.addBathroom=function(){MainMap.openPanel(),hideLoading(),ViewModel.model.view.panel.display.detail="",ViewModel.model.view.panel.display.add="true";var e=Object.assign({},DEFAULT_SMALL_MAP_OPTIONS);e.draggable=!0;var o=ViewModel.model.map.location,t=o.lat,a=o.lng;initMap({lat:t,lng:a},e)},shell.upvote=function(){vote("up")},shell.downvote=function(){vote("down")};