"use strict";function vote(e){$http(Constants.API.URL+"bathroom/vote/"+e+"/"+MainMap.selectedBathroom.id).post({gid:Google.guser.id,ukey:Google.guser.token}).then(function(e){iqwerty.toast.Toast("Thank you for your contribution!");var t=JSON.parse(e);delete t.total_score,Object.keys(t).forEach(function(e){MainMap.selectedBathroom[e]=t[e]})}).catch(function(){return iqwerty.toast.Toast("You must be logged in to vote")})}function showLoading(){document.querySelector("."+Constants.Iden.LOADING).classList.remove(Constants.Iden.HIDDEN)}function hideLoading(){document.querySelector("."+Constants.Iden.LOADING).classList.add(Constants.Iden.HIDDEN)}function initMap(e){var t=arguments.length<=1||void 0===arguments[1]?DEFAULT_SMALL_MAP_OPTIONS:arguments[1];"undefined"==typeof google&&setTimeout(function(){return initMap(e,t)},100),_map=new google.maps.Map(document.getElementById(MAP_VIEW_SMALL),t),_map.setCenter({lat:e.lat,lng:e.lng});var a=MainMap.location,o=a.lat,n=a.lng,i=a.accuracy;MainMap.addMyLocationMarker(_map,{lat:o,lng:n},i)}function attachBathroom(e){var t=new google.maps.Marker({position:{lat:e.lat,lng:e.lng},icon:Constants.ToiletImage.BATHROOM_MARKER});t.setMap(_map)}function bindBathroomData(e){hideLoading(),ViewModel.view.panel.display.detail="true",ViewModel.view.panel.display.add="",Object.assign(MainMap.selectedBathroom,e)}var Constants=require("../../../../assets/js/constants"),MainMap=require("./mainmap"),Google=require("./google"),ViewModel=require("./viewmodel"),shell=module.exports,MAP_VIEW_SMALL="map-view-small",DEFAULT_SMALL_MAP_OPTIONS={zoom:18,zoomControl:!0,disableDefaultUI:!0,draggable:!1,scrollwheel:!1,disableDoubleClickZoom:!0,streetViewControl:!0},_map=void 0;shell.openPanel=function(e){showLoading(),MainMap.openPanel(),$http(Constants.API.URL+"bathroom/get/id/"+e).cache().get().then(function(e){e=JSON.parse(e)[0],bindBathroomData(e),initMap({lat:e.lat,lng:e.lng}),attachBathroom(e)})},shell.closePanel=function(){MainMap.closePanel(),_map=null},shell.addBathroom=function(){MainMap.openPanel(),hideLoading(),ViewModel.view.panel.display.detail="",ViewModel.view.panel.display.add="true";var e=Object.assign({},DEFAULT_SMALL_MAP_OPTIONS);e.draggable=!0;var t=MainMap.location,a=t.lat,o=t.lng;initMap({lat:a,lng:o},e)},shell.upvote=function(){vote("up")},shell.downvote=function(){vote("down")};