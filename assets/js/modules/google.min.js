"use strict";function _signInChanged(e){if(e){document.getElementById(SIGN_IN_BUTTON).style.display="none";var n=ViewModel.model.user.guser;$http(Constants.API.URL+"login").post({gid:n.id,ukey:n.token})}else document.getElementById(SIGN_IN_BUTTON).style.display=""}function _userChanged(e){_guser=e;var n=e.getBasicProfile();if(n){var i=ViewModel.model.user.guser;i.token=_guser.getAuthResponse().id_token,i.name=n.getGivenName(),i.id=n.getId(),i.gpURL="https://plus.google.com/"+i.id,i.pic=n.getImageUrl(),i.token&&(ViewModel.model.view.guser.signedIn=!0),Apis.auth.resolve(),console.log(_guser,ViewModel.model.user.guser)}}function _renderLoginButton(){gapi.signin2.render(SIGN_IN_BUTTON,{scope:"email profile",width:110,height:30,theme:"dark",onsuccess:shell.loginSuccess,onfailure:shell.loginFailure})}var Constants=require("../../../../assets/js/constants"),ViewModel=require("./viewmodel"),Apis=require("./apis"),SIGN_IN_BUTTON="sign-in--google",shell=module.exports,_auth=void 0,_guser=void 0;shell.loadAuth=function(){gapi.load("auth2",function(){_auth=gapi.auth2.init({client_id:Constants.Google.OAUTH_ID,scope:"email profile"}),_auth.isSignedIn.listen(_signInChanged),_auth.currentUser.listen(_userChanged),_auth.isSignedIn.get()&&_auth.signIn(),setTimeout(function(){return _renderLoginButton()})})},shell.signIn=function(){document.getElementById(SIGN_IN_BUTTON).children[0].click()},shell.loginSuccess=function(){},shell.loginFailure=function(){iqwerty.snackbar.Snackbar("Login failed","Try again",shell.signIn,{settings:{duration:6e3}})},shell.logout=function(){_auth.disconnect(),ViewModel.model.view.guser.signedIn=!1};