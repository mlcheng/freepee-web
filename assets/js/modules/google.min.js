"use strict";function _signInChanged(e){e?(document.getElementById(SIGN_IN_BUTTON).style.display="none",$http(Constants.API.URL+"login").post({gid:shell.guser.id,ukey:shell.guser.token})):document.getElementById(SIGN_IN_BUTTON).style.display=""}function _userChanged(e){_guser=e;var n=e.getBasicProfile();n&&(shell.guser.token=_guser.getAuthResponse().id_token,shell.guser.name=n.getGivenName(),shell.guser.id=n.getId(),shell.guser.gpURL="https://plus.google.com/"+shell.guser.id,shell.guser.pic=n.getImageUrl(),shell.guser.token&&(ViewModel.guser.signedIn=!0),console.log(_guser,shell.guser))}function _renderLoginButton(){gapi.signin2.render(SIGN_IN_BUTTON,{scope:"email profile",width:110,height:30,theme:"dark",onsuccess:shell.loginSuccess,onfailure:shell.loginFailure})}var Constants=require("../../../../assets/js/constants"),ViewModel=require("./viewmodel"),SIGN_IN_BUTTON="sign-in--google",shell=module.exports,_auth=void 0,_guser=void 0;shell.guser={token:"",name:"",id:"",gpURL:"",pic:Constants.ToiletImage.BATHROOM_MARKER},shell.loadAuth=function(){gapi.load("auth2",function(){_auth=gapi.auth2.init({client_id:Constants.Google.OAUTH_ID,scope:"email profile"}),_auth.isSignedIn.listen(_signInChanged),_auth.currentUser.listen(_userChanged),_auth.isSignedIn.get()&&_auth.signIn(),setTimeout(function(){return _renderLoginButton()})})},shell.loginSuccess=function(){},shell.loginFailure=function(){iqwerty.snackbar.Snackbar("Login failed","Try again",function(){document.getElementById(SIGN_IN_BUTTON).children[0].click()},{settings:{duration:6e3}})},shell.logout=function(){_auth.disconnect(),ViewModel.guser.signedIn=!1};