"use strict";window.require=function e(o,t,n){function a(s,r){if(!t[s]){if(!o[s]){var l="function"==typeof require&&require;if(!r&&l)return l(s,!0);if(i)return i(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var d=t[s]={exports:{}};o[s][0].call(d.exports,function(e){var t=o[s][1][e];return a(t?t:e)},d,d.exports,e,o,t,n)}return t[s].exports}for(var i="function"==typeof require&&require,s=0;s<n.length;s++)a(n[s]);return a}({1:[function(e,o,t){var n={};n.API={URL:serverRoot+"api/v2/"},n.Google={OAUTH_ID:"992073863488-a3107lj0prdiih05id9n065bnhocmpve.apps.googleusercontent.com"},n.Iden={HIDDEN:"hidden",LOADING:"loading",SEARCH:"search"},n.ToiletImage={BATHROOM_MARKER:serverRoot+"mobile/assets/images/temp2.png"},"undefined"!=typeof o&&(o.exports=n)},{}],2:[function(e,o,t){function n(e){$http(c.API.URL+"bathroom/vote/"+e+"/"+d.selectedBathroom.id).post({gid:u.guser.id,ukey:u.guser.token}).then(function(e){iqwerty.toast.Toast("Thank you for your contribution!");var o=JSON.parse(e);delete o.total_score,Object.keys(o).forEach(function(e){d.selectedBathroom[e]=o[e]})}).catch(function(){return iqwerty.toast.Toast("You must be logged in to vote")})}function a(){document.querySelector("."+c.Iden.LOADING).classList.remove(c.Iden.HIDDEN)}function i(){document.querySelector("."+c.Iden.LOADING).classList.add(c.Iden.HIDDEN)}function s(e){var o=arguments.length<=1||void 0===arguments[1]?f:arguments[1];"undefined"==typeof google&&setTimeout(function(){return s(e,o)},100),h=new google.maps.Map(document.getElementById(p),o),h.setCenter({lat:e.lat,lng:e.lng});var t=d.location,n=t.lat,a=t.lng,i=t.accuracy;d.addMyLocationMarker(h,{lat:n,lng:a},i)}function r(e){var o=new google.maps.Marker({position:{lat:e.lat,lng:e.lng},icon:c.ToiletImage.BATHROOM_MARKER});o.setMap(h)}function l(e){i(),g.view.panel.display.detail="true",g.view.panel.display.add="",Object.assign(d.selectedBathroom,e)}var c=e("../../../../assets/js/constants"),d=e("./mainmap"),u=e("./google"),g=e("./viewmodel"),m=o.exports,p="map-view-small",f={zoom:18,zoomControl:!0,disableDefaultUI:!0,draggable:!1,scrollwheel:!1,disableDoubleClickZoom:!0,streetViewControl:!0},h=void 0;m.openPanel=function(e){a(),d.openPanel(),$http(c.API.URL+"bathroom/get/id/"+e).cache().get().then(function(e){e=JSON.parse(e)[0],l(e),s({lat:e.lat,lng:e.lng}),r(e)})},m.closePanel=function(){d.closePanel(),h=null},m.addBathroom=function(){d.openPanel(),i(),g.view.panel.display.detail="",g.view.panel.display.add="true";var e=Object.assign({},f);e.draggable=!0;var o=d.location,t=o.lat,n=o.lng;s({lat:t,lng:n},e)},m.upvote=function(){n("up")},m.downvote=function(){n("down")}},{"../../../../assets/js/constants":1,"./google":3,"./mainmap":4,"./viewmodel":5}],3:[function(e,o,t){function n(e){e?(document.getElementById(l).style.display="none",$http(s.API.URL+"login").post({gid:c.guser.id,ukey:c.guser.token})):document.getElementById(l).style.display=""}function a(e){u=e;var o=e.getBasicProfile();o&&(c.guser.token=u.getAuthResponse().id_token,c.guser.name=o.getGivenName(),c.guser.id=o.getId(),c.guser.gpURL="https://plus.google.com/"+c.guser.id,c.guser.pic=o.getImageUrl(),c.guser.token&&(r.guser.signedIn=!0),console.log(u,c.guser))}function i(){gapi.signin2.render(l,{scope:"email profile",width:110,height:30,theme:"dark",onsuccess:c.loginSuccess,onfailure:c.loginFailure})}var s=e("../../../../assets/js/constants"),r=e("./viewmodel"),l="sign-in--google",c=o.exports,d=void 0,u=void 0;c.guser={token:"",name:"",id:"",gpURL:"",pic:s.ToiletImage.BATHROOM_MARKER},c.loadAuth=function(){gapi.load("auth2",function(){d=gapi.auth2.init({client_id:s.Google.OAUTH_ID,scope:"email profile"}),d.isSignedIn.listen(n),d.currentUser.listen(a),d.isSignedIn.get()&&d.signIn(),setTimeout(function(){return i()})})},c.loginSuccess=function(){},c.loginFailure=function(){iqwerty.snackbar.Snackbar("Login failed","Try again",function(){document.getElementById(l).children[0].click()},{settings:{duration:6e3}})},c.logout=function(){d.disconnect(),r.guser.signedIn=!1}},{"../../../../assets/js/constants":1,"./viewmodel":5}],4:[function(require,module,exports){function locationUnavailable(){iqwerty.toast.Toast("Geolocation is not supported on your device"),initBasicMap()}function locationAvailable(){return"geolocation"in navigator}function initBasicMap(){_map=new google.maps.Map(document.getElementById(MAP_VIEW),DEFAULT_MAP_OPTIONS),updateMapOnMoved()}function initMap(e){var o=e.coords;shell.location={lat:o.latitude,lng:o.longitude,accuracy:o.accuracy};var t=Object.assign({},DEFAULT_MAP_OPTIONS);t.zoom=20,t.center={lat:shell.location.lat,lng:shell.location.lng},_map=new google.maps.Map(document.getElementById(MAP_VIEW),t),shell.addMyLocationMarker(_map,t.center,shell.location.accuracy),updateMapOnMoved()}function updateMapOnMoved(){_map.addListener("idle",getBathrooms)}function getBathrooms(){var e=_map.getCenter();$http(Constants.API.URL+"bathroom/get/coords/"+e.lat()+","+e.lng()+","+_map.getZoom()+"z").cache().get().then(function(e){e&&attachBathrooms(JSON.parse(e))})}function attachBathrooms(e){var o=[],t=createInfoWindow();e.filter(function(e){return!_markers.find(function(o){return e.id===o.id})}).forEach(function(e){var n=new google.maps.Marker({position:{lat:e.lat,lng:e.lng},icon:Constants.ToiletImage.BATHROOM_MARKER,title:e.approx_address,animation:google.maps.Animation.DROP,id:e.id});n.setMap(_map),n.addListener("click",function(){t.open(_map,n),t.setContent(getInfoWindowContent(e))}),o.push(n)}),_markers.push.apply(_markers,o),_markerClusterer?_markerClusterer.addMarkers(o):_markerClusterer=new MarkerClusterer(_map,_markers,{imagePath:serverRoot+"mobile/assets/images/clusterer/m"})}function createInfoWindow(){return _infoWindow||(_infoWindow=new google.maps.InfoWindow),_infoWindow}function getInfoWindowContent(bathroom){var template='<div class="info-window flex flex--row">\r\n\t<div class="flex-child flex flex--column info-window--description">\r\n\t\t<div class="address" title="${bathroom.approx_address}">\r\n\t\t\tFree Pee near ${bathroom.approx_address}\r\n\t\t</div>\r\n\t\t<div class="description">${bathroom.description}</div>\r\n\t</div>\r\n\t<div class="flex-child flex">\r\n\t\t<a class="button button--info-window" onclick="iqwerty.history.Push(\'bathroom/${bathroom.id}\');">more &raquo;</a>\r\n\t</div>\r\n</div>';return eval("`"+template+"`")}var Constants=require("../../../../assets/js/constants"),Bathroom=require("./bathroom"),shell=module.exports,MAP_VIEW="map-view",DEFAULT_MAP_OPTIONS={zoom:3,center:{lat:0,lng:0},disableDefaultUI:!0},_map=void 0,_markers=[],_markerClusterer=void 0,_infoWindow=null;shell.selectedBathroom={},shell.search={place:""},shell.location={},shell.BaseStateController=function(){shell.closePanel()},shell.BathroomStateController=function(e){Bathroom.openPanel(e)},shell.openPanel=function(){var e=document.getElementById("panel"),o=document.getElementById("overlay");e.classList.remove(Constants.Iden.HIDDEN),o.classList.remove(Constants.Iden.HIDDEN)},shell.closePanel=function(){var e=document.getElementById("panel"),o=document.getElementById("overlay");e.classList.add(Constants.Iden.HIDDEN),o.classList.add(Constants.Iden.HIDDEN)},shell.getLocation=function(){var e=initMap,o=locationUnavailable,t={enableHighAccuracy:!1,timeout:1e4};return locationAvailable()?void navigator.geolocation.getCurrentPosition(e,o,t):(o(),!1)},shell.addMyLocationMarker=function(e,o,t){var n={url:serverRoot+"mobile/assets/images/location.png",size:new google.maps.Size(20,20),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(10,10)},a=new google.maps.Marker({position:o,title:"My current location",icon:n});a.setMap(e),new google.maps.Circle({strokeColor:"#00838f",strokeWeight:1,fillColor:"#00838f",fillOpacity:.15,map:e,center:o,radius:t})},shell.toggleSearch=function(){var e=document.getElementById(Constants.Iden.SEARCH);e.classList.toggle(Constants.Iden.HIDDEN),e.classList.contains(Constants.Iden.HIDDEN)||e.querySelector("input").focus()}},{"../../../../assets/js/constants":1,"./bathroom":2,fs:6}],5:[function(e,o,t){var n=e("./mainmap"),a=e("./google"),i=o.exports;i.view={guser:{signedIn:!1},panel:{display:{detail:"false",add:"false"},add:{approx_address:null,description:null}}},i.template={bindBathroomData:function(){iqwerty.binding.Model({bathroom:n.selectedBathroom,search:n.search}),iqwerty.history.States({"":n.BaseStateController,"bathroom/:id":n.BathroomStateController},{base:serverRoot+"m/"})},bindToolbarData:function(){iqwerty.binding.Model({guser:a.guser,view:i.view})}}},{"./google":3,"./mainmap":4}],6:[function(e,o,t){},{}],"iqwerty-freepee":[function(e,o,t){var n=e("../../../assets/js/constants"),a=e("./modules/mainmap"),i=e("./modules/bathroom"),s=e("./modules/google"),r=e("./modules/viewmodel");"undefined"!=typeof o&&(o.exports={Constants:n,MainMap:a,Bathroom:i,Google:s,ViewModel:r})},{"../../../assets/js/constants":1,"./modules/bathroom":2,"./modules/google":3,"./modules/mainmap":4,"./modules/viewmodel":5}]},{},["iqwerty-freepee"]);